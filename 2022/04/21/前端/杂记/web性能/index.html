<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本文转载其他来源，如有侵权，请告知。">
<meta name="keywords" content="性能">
<meta property="og:type" content="article">
<meta property="og:title" content="web性能">
<meta property="og:url" content="http://yoursite.com/2022/04/21/前端/杂记/web性能/index.html">
<meta property="og:site_name" content="coder">
<meta property="og:description" content="本文转载其他来源，如有侵权，请告知。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/images/性能/1.png">
<meta property="og:image" content="http://yoursite.com/images/性能/2.png">
<meta property="og:image" content="http://yoursite.com/images/性能/3.png">
<meta property="og:image" content="http://yoursite.com/images/性能/4.png">
<meta property="og:image" content="http://yoursite.com/images/性能/5.png">
<meta property="og:image" content="http://yoursite.com/images/性能/6.png">
<meta property="og:image" content="http://yoursite.com/images/性能/7.png">
<meta property="og:image" content="http://yoursite.com/images/性能/8.png">
<meta property="og:image" content="http://yoursite.com/images/性能/9.png">
<meta property="og:image" content="http://yoursite.com/images/性能/10.png">
<meta property="og:image" content="http://yoursite.com/images/性能/11.png">
<meta property="og:image" content="http://yoursite.com/images/性能/12.png">
<meta property="og:image" content="http://yoursite.com/images/性能/13.png">
<meta property="og:image" content="http://yoursite.com/images/性能/14.png">
<meta property="og:image" content="http://yoursite.com/images/性能/15.png">
<meta property="og:image" content="http://yoursite.com/images/性能/16.png">
<meta property="og:image" content="http://yoursite.com/images/性能/17.png">
<meta property="og:updated_time" content="2022-04-21T08:18:23.778Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="web性能">
<meta name="twitter:description" content="本文转载其他来源，如有侵权，请告知。">
<meta name="twitter:image" content="http://yoursite.com/images/性能/1.png">





  
  
  <link rel="canonical" href="http://yoursite.com/2022/04/21/前端/杂记/web性能/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>web性能 | coder</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://15735046155.github.io/" class="github-corner" aria-label="View source on GitHub"><svg width="87" height="87" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">coder</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/04/21/前端/杂记/web性能/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="只有极其努力，才能看起来毫不费力。">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/杂记/one.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="coder">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">web性能

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2022-04-21 10:25:55 / 修改时间：16:18:23" itemprop="dateCreated datePublished" datetime="2022-04-21T10:25:55+08:00">2022-04-21</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/性能/" itemprop="url" rel="index"><span itemprop="name">性能</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          
            <div class="post-description">本文转载其他来源，如有侵权，请告知。</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>原文链接：<a href="https://ui.toast.com/fe-guide/en_PERFORMANCE/#minimizing-the-size-of-resources" target="_blank" rel="noopener">https://ui.toast.com/fe-guide/en_PERFORMANCE/#minimizing-the-size-of-resources</a></p>
<blockquote>
<p>本文档介绍了改善web应用性能的原因并提供了几种较实用的优化方案。<br>优化部分分为网页加载优化与网页渲染优化两大部分。其中：<br>【网页加载优化】提供了阻塞资源优化、最小化资源请求数、捆绑CSS和JavaScript、使用內联样式、以HTML和CSS代替小图像等优化方案。<br>【网页渲染优化】提供了布局优化、HTML和CSS优化、动画优化等优化方案。</p>
</blockquote>
<p>无论是在web层面抑或是在应用层面上，应用的性能优化都是非常重要的。现在的web应用程序已经变得十分庞大且密集，具有Ajax通信和复杂UI等功能。繁重的web应用最终会导致长时间的加载以及糟糕的用户体验感。举个例子，Pinterest，之前它过长的加载时间导致用户非常有可能离开当前页面，而它通过性能优化，不仅减少了跳出率也使得收入增加了40%。由于性能与盈利直接挂钩，因此优化Web应用程序的性能显得至关重要。本指南指在为读者提供性能优化的基本背景知识，并通过分别讨论网页加载与网页渲染来介绍各种优化方法。</p>
<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><h4 id="性能优化必备的理论和衡量工具"><a href="#性能优化必备的理论和衡量工具" class="headerlink" title="性能优化必备的理论和衡量工具"></a>性能优化必备的理论和衡量工具</h4><p>为了能有效地优化性能，我们需要对性能的概念和术语有个清晰的了解。本章将重点介绍浏览器加载页面的过程，并对用于各个阶段的性能衡量的技术术语及指标进行解释。于此同时，本章将介绍如何使用Chrome DevTools来衡量性能。</p>
<h5 id="浏览器是如何加载的？"><a href="#浏览器是如何加载的？" class="headerlink" title="浏览器是如何加载的？"></a>浏览器是如何加载的？</h5><p>浏览器通过多个后台操作（如下载必要的资源，转移上述资源等），将内容呈现在屏幕上。这些操作包括下载、解析、样式、布局、绘制以及合成，我们将这些统称为“加载阶段”。接下来，让我们一起来看看每个阶段分别做了些啥。</p>
<ol>
<li><strong>解析</strong></li>
</ol>
<p>首先，当浏览器加载页面时，它会下载HTML文件。解析是浏览器转换下载的HTML结构以构建<strong>DOM</strong>树的阶段。如果浏览器在解析阶段捕捉到<code>&lt;script/&gt;</code>, <code>&lt;link/&gt;</code>, 或者<code>&lt;div/&gt;</code>等元素时，它会请求适当的资源并下载下来。如果CSS也在HTML或者在资源中，浏览器同时也会构建CSSOM树。<strong>DOM</strong>树和<strong>CSSOM</strong>树的结构将会在下面进行详述。</p>
<p><strong>DOM树结构</strong><br>为了更好地解释DOM树结构，让我们先来看下以下HTML文件。<br>当解析发生时，浏览器将分析HTML文件以创建DOM，并通过树形数据结构连接每个DOM对象以建立父子关系。诸如<code>&lt;body&gt;</code>，<code>&lt;p&gt;</code>和<code>&lt;div&gt;</code>之类的标签则被创建为DOM树中的节点并引用子节点。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Critical Path<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span>&gt;</span>web performance<span class="tag">&lt;/<span class="name">span</span>&gt;</span> students!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"awesome-photo.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>CSSOM Tree Construction</strong></p>
<p>如上个例子所示，如果文件包含了外部样式文件或者像<code>style.css</code>一样的內联样式，浏览器会转换CSS并构造CSS对象模型（CSSOM）树。诸如body、p、span等选择器则会被用作节点，每个节点引用不同的样式。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* style.css */</span></span><br><span class="line">  <span class="selector-tag">body</span> &#123; <span class="attribute">font-size</span>: <span class="number">16px</span> &#125;</span><br><span class="line">  <span class="selector-tag">p</span> &#123; <span class="attribute">font-weight</span>: bold &#125;</span><br><span class="line">  <span class="selector-tag">span</span> &#123; <span class="attribute">color</span>: red &#125;</span><br><span class="line">  <span class="selector-tag">p</span> <span class="selector-tag">span</span> &#123; <span class="attribute">display</span>: none &#125;</span><br><span class="line">  <span class="selector-tag">img</span> &#123; <span class="attribute">float</span>: right &#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/性能/1.png" alt="image.png"></p>
<ol start="2">
<li><strong>样式计算</strong></li>
</ol>
<p>在样式计算阶段，浏览器通过使用在解析阶段构建的DOM和CSSOM树来构建另一种树，这种树用于使得每个元素都能与之相应的样式匹配。下图描述了如何通过组合在解析阶段构建的两棵树来制作渲染树：<br><img src="/images/性能/2.png" alt="image.png"></p>
<ol start="3">
<li><strong>布局</strong></li>
</ol>
<p>在布局阶段，浏览器会以数学方式去计算节点的确切位置和大小。为此，浏览器从根节点开始，并通过遍历整个树来计算每个节点，并将布局结果应用于渲染树的确切像素位置。下图展示了布局的前后。如果在CSS中使用百分比来表示尺寸，那么在布局之后，%表示法将被转换成像素单位(px)。<br><img src="/images/性能/3.png" alt="image.png"></p>
<p><img src="/images/性能/4.png" alt="image.png"></p>
<ol start="4">
<li><strong>绘制</strong></li>
</ol>
<p>在先前的布局阶段中，渲染树的每个节点通过计算出的属性被转化成实际像素。现在，浏览器将应用那些与元素位置无关的CSS属性，如颜色和透明度等。然后，像素化的结果会像在Photoshop一样被绘制成图层，并按照图层进行管理。然而，并不是所有元素都会被转换成图层。Transfrom属性会将这些元素构建成图层，这个过程被称为绘制。</p>
<ol start="5">
<li><strong>合成与渲染</strong></li>
</ol>
<p>浏览器使用绘制阶段所创建的一系列图层组合来更新屏幕。经过合成和渲染阶段，最后可以在屏幕上看到页面。<br>下图描述了浏览器的加载阶段。为了全面理解如何改进web应用程序，开发人员必须要具备浏览器加载阶段的实用知识，这一点很重要。<br><img src="/images/性能/5.png" alt="image.png"></p>
<h5 id="布局与重绘"><a href="#布局与重绘" class="headerlink" title="布局与重绘"></a>布局与重绘</h5><p>样式计算（样式计算 -&gt; 布局 -&gt; 绘制 -&gt; 合成）之后的浏览器加载阶段被统称为“渲染”。根据实际情况，这种渲染过程可能会发生多次。在样式计算阶段构造的渲染树，在每次因Js导致DOM树或CSSOM树变更时，都必须进行重构。例如，如果插入或删除了DOM，又或者更改了对设计有几何影响（比如高度、宽度、位置等）的CSS元素，则必须重建渲染树。因此，必须从布局阶段开始重复此过程，而这个过程也被称为<strong>布局</strong>。（在FireFox中这也被称为<strong>重排</strong>）</p>
<p><img src="/images/性能/6.png" alt="image.png"><br>如上所述，当影响几何布局的CSS元素有变化时，就会发生布局，但相反，如果所做的更改并不影响结构的几何形状，浏览器引擎就会跳过布局阶段。这个过程从绘制阶段开始继续，而此过程也被称为<strong>重绘</strong>。</p>
<p><img src="/images/性能/7.png" alt="image.png"><br>如果发生布局，引擎必须再次将整个页面呈现重新计算成像素，这会给引擎带来压力。然而，重绘只需要浏览器使用早就计算好的像素值去绘制页面，所以这在浏览器上会相对容易。下面给出的示例代码演示了布局与重绘所花费的时间之间的差异。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"sample"</span> <span class="attr">style</span>=<span class="string">"background:red;width:150px;height:50px;"</span>&gt;</span></span><br><span class="line">  Sample</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>在有几何效果的情况下更改元素属性的值：</strong></p>
<ul>
<li><p>css属性：height, width, left, top, font-size, line-height等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> example = <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>);</span><br><span class="line"></span><br><span class="line">example.style.width = <span class="string">'400px'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>发生布局：</p>
</li>
</ul>
<p><img src="/images/性能/8.png" alt="image.png"></p>
<p><strong>在没有几何效果的情况下更改元素属性的值：</strong></p>
<ul>
<li>css属性：background-color, color, visibility, text-decoration 等</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sample = <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>);</span><br><span class="line"></span><br><span class="line">example.style.backgroundColor = <span class="string">'blue'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>发生重绘：</li>
</ul>
<p><img src="/images/性能/9.png" alt="image.png"><br>正如上述表示，如果出现了布局，渲染时间会随着执行时间的增加而增加。因此，非常有必要确保那些没有必要的布局发生。</p>
<h5 id="阻塞资源和关键渲染路径"><a href="#阻塞资源和关键渲染路径" class="headerlink" title="阻塞资源和关键渲染路径"></a>阻塞资源和关键渲染路径</h5><p>在浏览器加载的初期，也就是解析发生的时候，如果浏览器运行CSS或JS，则可以暂停解析。这种情况通常被描述为“HTML解析阻塞”，造成阻塞的资源被称为“阻塞资源”。阻塞资源会延迟加载的绘制阶段，因此开发者必须格外注意防止阻塞资源去阻塞HTML资源。Google解释道，加载速度可以通过优化关键渲染路径（CRP）来得到提升，这将会在下一章节进行详细讨论。</p>
<h5 id="性能改善指标"><a href="#性能改善指标" class="headerlink" title="性能改善指标"></a>性能改善指标</h5><p>到此为止，这篇文章已经分析了那些可能对加载进程产生不利影响的元素。现在，我们将讨论如何去加快进程加载。为了明白需要提升什么东西，我们必须弄清楚什么样的情况下加载速度会变慢。性能指标的衡量标准主要分为两类：从浏览器角度以及从用户角度。接下来的篇章将深入阐述这两类有何不同，同时也会介绍用于衡量性能的指标。</p>
<p><strong>从浏览器角度衡量性能</strong></p>
<p>衡量性能的传统方法是将浏览器中发生的事件作为里程碑。当页面加载时，DOMContentLoaded以及加载事件发生，并根据各个事件的发生时间来衡量性能。下图是一个导航时序处理模型的示意图，这个模型表明，DOMContentLoaded事件（蓝色下划线部分）以及加载事件（红色下划线部分）出现得越快，两者之间的延迟会越短，性能也就越好。</p>
<p><img src="/images/性能/10.png" alt="image.png"></p>
<p>DOMContentLoaded事件和加载事件的特定发生点如下。</p>
<p><strong>【DOMContentLoaded事件】</strong></p>
<ul>
<li>当HTML和CSS解析完成时</li>
<li>当引擎准备构建渲染树时（DOM和CSSOM已经被构建好）</li>
</ul>
<p><strong>【加载事件】</strong></p>
<ul>
<li>当HTML的所有资源都已经加载完成时</li>
</ul>
<p>可以使用<em>Chrome DevTools（谷歌开发者工具）</em>或使用<em>导航计时API</em>来监视这两个事件的发生点。</p>
<p><strong>【使用导航计时API】</strong></p>
<p>浏览器提供了导航计时API供开发者们衡量页面的性能。使用导航计时API中 <code>PerformanceNavigationTiming</code>的<code>domContentLoadedEventStart</code>属性以及通过使用<code>loadEventStart</code>，开发者们可以分别获取到<code>DOMcontentLoaded</code>和<code>load</code>发生的时间点。</p>
<p><strong>【使用Chrome DevTools】</strong></p>
<p>Chrome DevTools提供了多种用户界面以及方法来检测事件发生的时间点以及衡量性能。在DevTools的下半部分，DOMContentLoaded和load事件发生的时间点被分别标记为蓝色和红色。相比于使用导航计时API，开发者们通过Chrome DevTools能够更容易捕捉到事件发生的时间点。</p>
<p><img src="/images/性能/11.png" alt="image.png"></p>
<p>然而，随着发展范式的不断变化，仅仅凭借DomContentLoaded和load事件发生的时间点来判断应用的性能变得越来越难。最近流行的单页应用程序（SPA）的DOMContentLoaded和加载事件发生的时间点很早，但是由于其他脚本继续运行，这个程序加载仍然很慢。因此，开发者们必须想出一种通过用户角度来衡量性能的方法。</p>
<p><strong>从用户角度衡量性能</strong><br>从用户的角度衡量性能基于显示给用户的内容的多个时间戳。有意义的内容越快地被呈现给用户，应用的性能就越好，开发者们应当尝试优化代码让内容呈现发生得更快。下图是两个渲染脚本的对照，两个脚本均有并发DOMCotentLoaded和load事件发生，不同的是，一个代码已被优化，而另一个代码没有被优化。在被优化的代码中，经过0.3秒，页面的部分内容已经能够看到了，页面逐渐呈现出来。而没有被优化的代码中，经过1.5秒的空白期，第一个页面才得以呈现。而大部分用户将会觉得被优化的代码更“快”。<br><img src="/images/性能/12.png" alt="image.png"></p>
<p>Google定义了多个让用户感到该页面是否已快速加载的时刻，这些时刻被用于衡量性能，我们将在下面对它们进行描述。</p>
<p><strong>【 First Paint（FC）- 首次绘制 】</strong><br>有东西出现在空白页面时。</p>
<p><strong>【 First Contentful Paint（FCP） - 首次内容绘制 】</strong><br>文字或者图片开始被绘制时。</p>
<p><strong>【 First Meaningful Paint（FMP） - 首次有效绘制 】</strong><br>对用户有意义的内容开始被绘制时。呈现内容所需的CSS和JavaScript开始加载，且已经应用样式，以便内容得以被理解。</p>
<p><strong>【Time to Interactive（TTI）- 可交互时间 】</strong><br>JavaScript完成执行，用户可以进行操作时。</p>
<p><img src="/images/性能/13.png" alt="image.png"><br>在上述时刻中，FMP是最为重要的，并且在加载完成前向用户呈现出有用的信息是必不可少的，因为这可以给用户留下一个“这应用还挺快”的印象。从用户的角度来看，好的性能意味着快速实现首次有效绘制，这可以通过优化上述关键渲染路径得以实现。</p>
<h5 id="性能衡量工具"><a href="#性能衡量工具" class="headerlink" title="性能衡量工具"></a>性能衡量工具</h5><p>前面所述的Devtools由谷歌浏览器提供，它可以用于验证到目前为止已讨论的所有内容。DevTools提供了三个与性能相关的面板，分别是Network（网络），Performance（性能）和Audits（审计）。这一章我们将阐述各个面板所扮演的角色以及用途，下一章将阐述如何将它们实际应用到项目中去。</p>
<p><strong>性能面板</strong><br>性能面板能够让用户通过图表监控此前提到的每个加载阶段。当页面加载时，每个加载阶段都会被记录下来，并且还可以监控某个确切时间发生的时间。这个面板主要用于指出在加载过程中哪个领域必须被优化。</p>
<p><strong>【面板信息】</strong></p>
<ul>
<li>（1）Controls：包括开始和清空记录的按钮。<ul>
<li>第一个按钮用于手动控制记录。</li>
<li>第二个按钮用于当页面刷新时，自动开启记录，而当页面加载完成时，自动停止记录。</li>
</ul>
</li>
<li>（2）Capture<ul>
<li>Screenshots：根据时间呈现不同的渲染状态。</li>
<li>Memory：显示堆内存状态</li>
<li>Garbage Collection：手动启用垃圾收集</li>
</ul>
</li>
<li>（3）Overview：显示装载机的概述</li>
<li>（4）Main：详细显示在“Overview”部分中选择的区域。</li>
<li>（5）Details：显示有关在“main”部分中选择的区域的详细信息。</li>
</ul>
<p><img src="/images/性能/14.png" alt="image.png"><br><strong>【 检查网页加载过程 】</strong><br>可以使用控制项（Controls）去记录整个过程来检查整个加载过程，然后在Main区域中对其进行监视。<br>（此处本应有图，然图挂了）</p>
<p><strong>网络面板</strong><br>网络面板可以用于监控在加载过程中被请求的资源的状态，也被用于比较和优化资源状态。与性能面板一样，在记录完成后，资源请求信息可以在Overview和Request表中被找到。资源列表按照时间排序，通过单击图表可以访问相应的服务器请求响应时间。同时，DOMContentLoaded和load出现的时间点会在打印在底部。</p>
<p><strong>【 面板信息 】</strong></p>
<ul>
<li>（1）Controls（控制项）：控制面案的显示和运行。</li>
<li>（2）Filters（筛选）：筛选出需要显示的资源。</li>
<li>（3）Overview（概述）：显示请求和下载流程的概述。</li>
<li>（4）Request Table（请求表）：显示检测各个资源请求和下载的状态。</li>
<li>（5）Summary（总结）：显示请求资源的总数，传输数据的大小和事件加载时间。</li>
</ul>
<p>（此处本应有图，然图挂了）</p>
<p><strong>【监视服务器请求响应时间】</strong></p>
<ul>
<li>（1）Queuing：排队时间<ul>
<li>JavaScript和CSS具有更高的优先级。</li>
<li>TCP Socket Queue（TCP 套接字队列）</li>
<li>TCP Connection Timeout Queue（TCP 连接超时队列）</li>
<li>Disk Cache Formation Queue（磁盘缓存形成队列）</li>
</ul>
</li>
<li>（2）Stalled：请求发送之前的停滞时间<ul>
<li>在排队(Queuing)中花费的时间。</li>
<li>代理协商所需要的时间。</li>
</ul>
</li>
<li>（3）DNS Lookup：花费在DNS查找上的时间。</li>
<li>（4）Initial Connection：TCP握手/重试和建立连接（包括SSL）上花费的时间。</li>
<li>（5）Waiting（TTFB）：等待第一个字节的时间。</li>
<li>（6）Content Download：花费在实际下载资源的时间。</li>
</ul>
<p><img src="/images/性能/15.png" alt="image.png"></p>
<p><strong>审核面板</strong><br>审核面板可以用于监控来自用户角度的性能衡量指标。面板屏幕主要被划分成两部分——前与后。在面板屏幕的前部分，开发者可以指定在哪个环境中衡量性能。如果需要模拟低网速，则可以配置节流区域，当选择“审核运行”按钮时，性能测量就开始了。下面将展示运行结果：</p>
<p><strong>【审核前】</strong><br><img src="/images/性能/16.png" alt="image.png"></p>
<p><strong>【审核后】</strong></p>
<ul>
<li>（1）Metrics：显示性能测量指标中指定的时刻。<ul>
<li>显示FCP，FMP和TTI时间戳。</li>
<li>显示在屏幕快照中的页面加载阶段。</li>
</ul>
</li>
<li>（2）Opportunities：显示可优化的可能资源列表。</li>
<li>（3）Diagostaics：显示其他可能的改进功能以及相应的解决方案。<ul>
<li>请参阅“Critical Request Chains（关键请求链）”以优化关键渲染路径</li>
</ul>
</li>
<li>（4）Passed audits：显示通过的审核和评估的标准</li>
</ul>
<p><img src="/images/性能/17.png" alt="image.png"></p>
<h4 id="网页加载优化"><a href="#网页加载优化" class="headerlink" title="网页加载优化"></a>网页加载优化</h4><p>根据前几章讨论的内容，在接下来的章节我们将会实际讨论如何有效地优化加载流程。网页加载优化将基于关键渲染路径优化。</p>
<h5 id="阻塞资源（CSS，JavaScript）优化"><a href="#阻塞资源（CSS，JavaScript）优化" class="headerlink" title="阻塞资源（CSS，JavaScript）优化"></a>阻塞资源（CSS，JavaScript）优化</h5><p>之前提到过，在浏览器加载阶段，阻塞资源可能会出现，而CSS和JavaScript就是这样的阻塞资源。优化这样的阻塞元素是优化流程的第一步。</p>
<p><strong>CSS优化</strong><br>为了构建渲染树，浏览器需要DOM树和CSSOM树。虽然在解析阶段，DOM树可以在浏览器运行到每个标记时被构建，但是CSSOM树只能在CSS被完全转换时才能构建。因此，如果CSSOM树没有完成构建，渲染树就不能被构建，它就阻塞了渲染。正因如此，CSS被认为是渲染阻塞资源，而为了避免渲染阻塞，CSS通常应当被放在<code>&lt;head&gt;</code>标签中。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除此之外，如果一片CSS资源只在特殊情况下被请求，使用media queries（媒体查询）可以阻止阻塞发生。举个例子，如果有一片CSS资源只在打印页面（print.css）时被使用到或者显示器处于纵向模式（portrait.css），在<script>标签中指定media属性可以让它只在特定环境下加载。</p>
<p><strong>优化前（**</strong>没有使用<strong>**media queries）</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"print.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"portrait.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p> <strong>优化后（使用了media queries）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"print.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">media</span>=<span class="string">"print"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"portrait.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">media</span>=<span class="string">"orientation:portrait"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>同时，从外部导入样式时，避免使用<code>@import</code>。因为浏览器不能并行地加载不同的样式，<code>@import</code>会增加不必要的加载时间。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* foo.css */</span></span><br><span class="line"><span class="keyword">@import</span> url(<span class="string">"bar.css"</span>)</span><br></pre></td></tr></table></figure>
<p>此外，考虑在适当的情况下使用內联样式。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line">      background-color: red;   </span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>JavaScript优化</strong><br>JavaScript被归类为停止HTML解析的阻塞资源是因为它能够动态操纵DOM树和CSSOM树。当浏览器引擎运行到<script>标签时，它必须执行脚本，而该脚本只能访问到目前为止已构建的DOM。同时，当脚本完成执行时，DOM树的构建会被停止。如果屏幕必须从外部资源下载，构建就必须等待，直到引擎完成下载所有外部资源并执行它们。这就是JavaScript被归为阻塞资源，且通常应当被放在文档底部（在<code>&lt;/body&gt;</code>标签之前）的原因。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>有一种方法可以阻止JavaScript和CSS脚本中断HTML解析进程，即使它们被包含在<head>标签中。我们可以通过为<script>标记分配<code>defer</code>或<code>async</code>属性来完成。<code>defer</code>和<code>async</code>属性声明它们将不会尝试更改DOM和CSSOM，因此浏览器不必停止解析进程。然而，请务必注意，这些属性在浏览器兼容性方面会受到限制。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"https://google.com/analatics.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>使用Chrome DevTools比较阻塞资源优化前后</strong></p>
<p>让我们比较一下Chrome DevTools中使用性能面板来优化阻塞资源使用的前后效果。检查尚未优化的页面加载进程，我们会发现，阻塞资源在解析阶段被执行，当资源脚本完成执行时，HTML再继续解析代码。在下图中，“解析HTML”因解析被终止而发生了两次，但是在优化的页面中，“解析HTML”阶段没有被CSS或JavaScript打断。</p>
<p><strong>【优化前】</strong></p>
<ul>
<li>CSS文件没有在<head/>中加载</li>
<li>JavaScript文件在<head/>中加载</li>
</ul>
<p><img src="/images/性能/18.png" alt="image.png"></p>
<p><strong>【优化后】</strong></p>
<ul>
<li>CSS文件在<head/>中加载</li>
<li>JavaScript紧接着</body>标签前加载</li>
<li>使用了內联样式</li>
</ul>
<p><img src="/images/性能/19.png" alt="image.png"></p>
<h5 id="最小化资源请求数"><a href="#最小化资源请求数" class="headerlink" title="最小化资源请求数"></a>最小化资源请求数</h5><p>页面中包含的资源，比如CSS、Javascript和图片等，只能在将它们请求到服务器并下载后才能被使用。下图显示了使用DevTools的“网络”面板请求一个文件所需的时间。这个文件实际的下载时间为1.03ms，而其他的等待时间（花费的总时间 - 实际下载时间）则是127.45ms。显然仅仅是下载一个文件就要花费很多时间，因此将那些绝对必要的请求的数量降至最低非常重要。这一节将更深入地探讨减少对不同类型资源的请求数量。<br><img src="/images/性能/20.png" alt="image.png"></p>
<p><strong>图片脚本</strong><br>在下面的例子中，如果每个icon使用不同的图片文件，那么对于这个例子，总共要有七个资源请求。图片脚本是一种可以将七个请求减少到一个请求的方法。<br><img src="/images/性能/21.png" alt="image.png"><br>图片脚本将多个图片组合成一个，并使用CSS的<code>background-position</code>属性去只展示整个图片的一部分。在下方CSS中使用的<code>icons-sprite.png</code>是一个精灵图片。使用脚本方法能够让页面加载得更快。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>Confirm<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(../images/icon-sprite.png);</span><br><span class="line">  <span class="attribute">background-position</span>: <span class="number">10px</span> <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来的截屏比较了使用多个图片和使用一个图片脚本的性能。使用了图片脚本的版本因为减少了资源请求的数量，它的性能明显提高。</p>
<p><strong>优化前（使用多个图片）</strong><br><img src="/images/性能/22.png" alt="image.png"></p>
<p><strong>优化后（使用一个图片脚本）</strong></p>
<p><img src="/images/性能/23.png" alt="image.png"></p>
<h5 id="捆绑CSS和JavaScript"><a href="#捆绑CSS和JavaScript" class="headerlink" title="捆绑CSS和JavaScript"></a>捆绑CSS和JavaScript</h5><p>在将开发人员介绍给模块化开发之前，开发人员必须导入多个外部资源文件。在下方没有被优化的例子中，一共有5个资源请求出现（2个CSS文件请求和3个JavaScript文件请求）。在这个例子中，像webpack这样的捆绑器可以用来减少CSS和JavaScript请求的数量。捆绑器将多个文件组合成一个，这样的文件被称为捆绑文件。（有关模块和捆绑的更多信息，请参见[<a href="">FE指南</a>]捆绑器）</p>
<p><strong>优化前（使用分散资源）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"foo.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bar_baz.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"foo"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"foo.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"bar.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"baz.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>优化后（使用捆绑资源）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bundle.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"foo"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="使用內联样式"><a href="#使用內联样式" class="headerlink" title="使用內联样式"></a>使用內联样式</h5><p>我们可以使用<style>标签代替使用<link>标签导入的外部样式表。使用<style>标签去定义样式被称为使用<em>內联样式，</em>它可以减少对外部样式的请求数。然而，內联样式无权访问资源缓存，因此建议仅在CSS始终包含在HTML中时才使用它。</p>
<p><strong>优化前（使用外部样式）</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bundle.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"foo"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>优化后（使用内部样式）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.foo</span> &#123;</span></span><br><span class="line">        background-color: red;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"foo"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="使用HTML和CSS代替小图像"><a href="#使用HTML和CSS代替小图像" class="headerlink" title="使用HTML和CSS代替小图像"></a>使用HTML和CSS代替小图像</h5><p>如果网页中使用的icon图像数量相对较少，那么也可以将图像包含在HTML和CSS中，而不是使用下载的图像。这可以通过使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/data_URIs">Data URL</a>来完成，它用于将使用外部路径导入的图像转换为Base64 URI。有了Base64 URI，浏览器就不必为了下载特定图像而去发送请求。然而，这种方法与內联样式有着同样的问题，因此，只能在绝对必要的时候使用。</p>
<p><strong>优化前（使用外部图片）</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn</span>&#123;<span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'../img/arrow_top.png'</span>) no-repeat <span class="number">0</span> <span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src="../img/arrow_top.png" /&gt;</span><br></pre></td></tr></table></figure>
<p><strong>优化后（图片已被转化成Base64)</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn</span>&#123;<span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAAAAXNSR0IArs4c6QAAAHBJREFUKBVjYBimICwsLAaEsXmPGV0QqnAeUNxfW1v7/tWrVy8hq0HRgKQ4CahoIxDPQ9cE14CseNWqVUtAJoMUo2tiBFkXGRmp9/fv3zNAZhJIMUgMBmAGMTMzmyxfvhzhPJAmmCJ0Gp8cutqhwAcASWgwk+79LiQAAAAASUVORK5CYII='</span>) no-repeat <span class="number">0</span> <span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAAAAXNSR0IArs4c6QAAAHBJREFUKBVjYBimICwsLAaEsXmPGV0QqnAeUNxfW1v7/tWrVy8hq0HRgKQ4CahoIxDPQ9cE14CseNWqVUtAJoMUo2tiBFkXGRmp9/fv3zNAZhJIMUgMBmAGMTMzmyxfvhzhPJAmmCJ0Gp8cutqhwAcASWgwk+79LiQAAAAASUVORK5CYII=" /&gt;</span><br></pre></td></tr></table></figure>
<h5 id="缩减资源的大小"><a href="#缩减资源的大小" class="headerlink" title="缩减资源的大小"></a>缩减资源的大小</h5><p>大量资源也会导致网站加载缓慢。建议使用每个文档的压缩版本，以最小化文件大小并优化性能。</p>
<p><strong>消除冗余代码</strong><br>我们以常用的<code>util.js</code>文件为例。冗余代码会让文件变得更大，从而减缓整个加载进程。</p>
<p><strong>优化前（包含了冗余代码）</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// foo.js</span><br><span class="line">function filter() &#123; ... &#125;</span><br><span class="line">function map() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">filter</span>();</span><br><span class="line"><span class="selector-tag">map</span>();</span><br></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// bar.js</span><br><span class="line">function filter() &#123; ... &#125;</span><br><span class="line">function find() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">filter</span>();</span><br><span class="line"><span class="selector-tag">find</span>();</span><br></pre></td></tr></table></figure>
<p><strong>优化后（消除冗余代码）</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// utils.js</span><br><span class="line">export function find() &#123; ... &#125;</span><br><span class="line">export function filter() &#123; ... &#125;</span><br><span class="line">export function map() &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// foo.js</span><br><span class="line">import &#123;filter, map&#125; from 'utils.js'</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">filter</span>();</span><br><span class="line"><span class="selector-tag">map</span>();</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// bar.js</span><br><span class="line">import &#123;filter, find&#125; from 'utils.js'</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">filter</span>();</span><br><span class="line"><span class="selector-tag">find</span>();</span><br></pre></td></tr></table></figure>
<p><strong>警惕多合一实用程序库</strong><br>使用Lodash等多合一实用程序库时要格外小心。随意导入整个库会急剧增加JS文件的大小。考虑导入选择的库，只包括绝对必要的部分，避免使用包含大量不必要代码的库。</p>
<p><strong>优化前（引入整个lodash库）</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import _ from 'lodash';</span><br><span class="line"></span><br><span class="line">_<span class="selector-class">.array</span>(...);</span><br><span class="line">_<span class="selector-class">.object</span>(...);</span><br></pre></td></tr></table></figure></p>
<p><strong>优化后（选取库的部分引入）</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import array from 'lodash/array';</span><br><span class="line">import object from 'lodash/fp/object';</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">array</span>(...);</span><br><span class="line"><span class="selector-tag">object</span>(...);</span><br></pre></td></tr></table></figure></p>
<h5 id="HTML标记优化"><a href="#HTML标记优化" class="headerlink" title="HTML标记优化"></a>HTML标记优化</h5><p>HTML应该使用最少的嵌套标签简单地编写。也建议通过去除空格和注释来丑化代码。推荐的DOM树节点数，最大深度和最大带子节点的父节点数分别小于1,500、32深度和60以下。重要的是要防止DOM树因不必要的标记而变得太大，从而防止HTML文件的总文件大小变得太大。</p>
<p><strong>优化前（不必要的标签，空格，注释）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- blar blar blar --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>优化后（简洁的标记）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="使用简洁的CSS选择器"><a href="#使用简洁的CSS选择器" class="headerlink" title="使用简洁的CSS选择器"></a>使用简洁的CSS选择器</h5><p>我们可以通过使用简洁的CSS选择器来优化CSS文件。使用Class代替id，可以帮助开发者们共同解决冗余样式问题。</p>
<p><strong>优化前（不必要的选择器）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#wrapper</span> &#123;</span></span><br><span class="line">        border: 1px solid blue; </span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line"><span class="css">      <span class="selector-id">#wrapper</span> <span class="selector-id">#foo</span> &#123;</span></span><br><span class="line">        color: red;</span><br><span class="line">        font-size: 15px;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line"><span class="css">      <span class="selector-id">#wrapper</span> <span class="selector-id">#bar</span> &#123;</span></span><br><span class="line">        color: red;</span><br><span class="line">        font-size: 15px;</span><br><span class="line">        font-weight: bold;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line"><span class="css">      <span class="selector-id">#wrapper</span> <span class="selector-id">#bar</span> &gt; <span class="selector-tag">span</span> &#123;</span></span><br><span class="line">         color: blue;</span><br><span class="line">         font-weight: normal;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"foo"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"bar"</span>&gt;</span></span><br><span class="line">        javascript <span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>优化后（简洁的选择器）</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line">        border: 1px solid blue; </span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line"><span class="css">      <span class="selector-class">.text</span> &#123;</span></span><br><span class="line">        color: red;</span><br><span class="line">        font-size: 15px;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line"><span class="css">      <span class="selector-class">.strong</span> &#123;</span></span><br><span class="line">        font-weight: bold;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line"><span class="css">      <span class="selector-class">.wrapper</span> <span class="selector-class">.text</span> &#123;</span></span><br><span class="line">        color: blue;</span><br><span class="line">        font-weight: normal;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text strong"</span>&gt;</span></span><br><span class="line">        javascript <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>削减</strong><br>所有的HTML，JavaScript以及CSS可以在作业阶段被压缩，而不必要的空格和注释应当去除或减少。这可以通过webpack插件之类的工具完成。</p>
<h4 id="网页渲染优化"><a href="#网页渲染优化" class="headerlink" title="网页渲染优化"></a>网页渲染优化</h4><p>为了渲染网页，DOM和CSS是必需的。然而，由于JavaScript常被用于生成各种各样的效果和功能，因此认识到JavaScript如何影响渲染性能至关重要。并且，因为JavaScript在浏览器中被用作单线程，渲染性能直接与JavaScript性能相关。渲染时间包括了执行Js的所有时间以及重绘由JavaScript导致的DOM和CSS更改的结果所需的时间。渲染性能优化需要优化花费在这些活动的时间，并且持续向用户提供可视化内容。这一节我们将讨论网页渲染进程的哪些部分会影响到性能，特别是哪块Js代码会影响到渲染性能。</p>
<p><strong>布局优化</strong><br>渲染进程的布局阶段是DOM元素被计算出它们在屏幕上的位置和大小的阶段。如果Js代码改变了DOM或者样式，引擎就必须应用这些样式变更，再次去进行计算并最终得以渲染页面。因为这一过程必须计算每个元素，包括相对于其他元素的每种字体大小），因此需要花费挺长时间。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/139408/1588036499236-15aa8351-f59b-4a95-91ad-0d0b8fb2715c.png#align=left&amp;display=inline&amp;height=60&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=119&amp;originWidth=609&amp;size=53997&amp;status=done&amp;style=none&amp;width=304.5" alt="image.png"><br>布局优化的目的是为了减少请求执行布局的时间，同时确保布局阶段发生得尽可能少。让我们一起来看看如何通过优化Js、HTML、CSS来达到这个目的吧～</p>
<p><strong>JS优化</strong><br>如果js运行需要花费一段时间，渲染性能可能会遭到损害，因为每一帧都要更长的时间来处理。如果JS有非常多的任务需要去完成，花费一点时间也是合情合理，但是当代码简单的却触发不必要的布局时，就会导致出现问题，由此会造成性能下降。因此，减少由DOM和样式产生的变更以避免不必要的布局产生是非常重要的。</p>
<p><strong>强制同步布局优化</strong><br>当一个DOM属性发生改变时，为了更新屏幕可能会发生布局。本来，布局可以异步发生，但是在特殊情况（比如读取一个特定元素的属性值）下可以被强制同步发生。为了检索最新值，浏览器将会强制布局，这被称为强制同步布局。强制同步布局会增加JS的运行时间，因此，一般建议避免使用这种方法。下面列出了可能导致强制同步布局的可能情形，并给出了相应的优化方案。</p>
<p><strong>避免强制同步布局</strong><br>在遍更样式后，尝试使用类似于offsetHeight或者offsetTop这样方法去检索计算值时，强制同步布局就会出现。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> tabBtn = <span class="built_in">document</span>.getElementById(<span class="string">'tab_btn'</span>);</span><br><span class="line"></span><br><span class="line">  tabBtn.style.fontSize = <span class="string">'24px'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(testBlock.offsetTop); <span class="comment">// Synchronous layout is forced internally immediately before calling the offsetTop</span></span><br><span class="line">  tabBtn.style.margin = <span class="string">'10px'</span>;</span><br><span class="line"><span class="comment">// Layout</span></span><br></pre></td></tr></table></figure></p>
<p>如果在返回值之前，样式变更还没有被应用，函数会检索过时的值并强制执行同步。即使是在最先进的浏览器，强制同步布局也会发生，所以说，不使用任何会产生强制同步布局的代码是非常必要的。</p>
<p><strong>避免布局颠簸</strong><br>如果强制同步布局在一帧內反复发生，性能会显著下降。以下代码遍历了段落[i]，并配置box元素的区域以匹配段落[i]的区域。如果<code>style.width</code>已经配置，又在同一循环內执行<code>box.offsetWidth</code>，那么循环每执行一次，布局就会出现一次。这种现象被称为颠簸。而在循环外检索<code>box</code>元素的高度则可以避免布局颠簸。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resizeAllParagraphs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> box = <span class="built_in">document</span>.getElementById(<span class="string">'box'</span>);</span><br><span class="line">  <span class="keyword">const</span> paragraphs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.paragraph'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paragraphs.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    paragraphs[i].style.width = box.offsetWidth + <span class="string">'px'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code improved to prevent layout thrashing</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resizeAllParagraphs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> box = <span class="built_in">document</span>.getElementById(<span class="string">'box'</span>);</span><br><span class="line">  <span class="keyword">const</span> paragraphs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.paragraph'</span>);</span><br><span class="line">  <span class="keyword">const</span> width = box.offsetWidth;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paragraphs.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    paragraphs[i].style.width = width + <span class="string">'px'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>操作最低的DOM节点<br>当一个DOM发生变化时，样式计算、布局以及绘制阶段必须全部重新开始。如果这个元素嵌套其他节点的深处，那么引擎就会花更久的时间去找这个节点，导致更新每帧的时间增加。</p>
<p><strong>检查点</strong></p>
<ul>
<li>当DOM树中的一个父节点发生样式变更，也会影响到它的子节点。</li>
<li>而最小化操作范围可以减小布局的范围。</li>
</ul>
<p><strong>限制受影响的元素</strong><br>在某些情况，DOM或者样式的某个变更会影响到旁边的元素，造成邻近元素额外的布局。</p>
<p><strong>检查点</strong></p>
<ul>
<li>父子关系：如果在父节点的高度可变时改变了子节点的高度，布局就会从父节点元素一路向下。这种情况下，如果父节点的高度是固定的，在父节点下面的元素就不会被影响。比如说，如果有多个不同高度的选项卡内容，固定父节点（选项卡高度）高度就可以将作用域减到最小。</li>
<li>具有相同位置的元素：如果多个元素都是内敛放置，如果改变第一个元素的width将会造成其余元素的位置改变。</li>
</ul>
<p><strong>编辑被隐藏的元素</strong><br>如果元素的样式被设置为<code>display:none</code>，即使DOM和样式发生了改变，布局和重绘也不会发生。如果有必要一次性改变多个元素，可以先把它们隐藏，在让它们可见以减少布局的发生。<code>visibility: hidden</code>不会导致重绘，因为它是不可见的；但是由于它确实占了个位子，所以它还是会引发布局的。</p>
<p><strong>检查点</strong></p>
<ul>
<li><code>display:none</code>对性能是有好处的，因为它不会造成任何布局或重绘。</li>
</ul>
<h5 id="HTML和CSS优化"><a href="#HTML和CSS优化" class="headerlink" title="HTML和CSS优化"></a>HTML和CSS优化</h5><p>HTML和CSS对于渲染而言是必不可少的，在渲染阶段，它们分别负责构造DOM树和CSSOM树。DOM树和CSSOM树的变更会引发渲染，并且树越大，计算就越复杂。因此，优化HTML和CSS代码对于渲染性能也是有好处的。</p>
<p><strong>减少CSS规则的数量</strong><br>当元素的class产生变化时，会导致渲染发生；如果CSS很复杂或者其中涉及到很多规则，就会使得计算和布局消耗更多的时间。</p>
<p><strong>检查点</strong></p>
<ul>
<li>规则越少，计算越快，渲染越快。</li>
<li>尽量避免使用复杂的选择器，它们会增加样式计算时间。</li>
</ul>
<p><strong>减小DOM的深度</strong><br>DOM树越深或者DOM树每个节点都有很多子节点，会导致树变得很大。树越大，每次更新所需的计算量就越大。</p>
<p><strong>检查点</strong></p>
<ul>
<li>DOM树越小，计算速度越快。</li>
<li>移除不必要的包装器元素。</li>
</ul>
<h5 id="动画优化"><a href="#动画优化" class="headerlink" title="动画优化"></a>动画优化</h5><p>为了能够更自然地渲染，单帧必须在16ms(60fps)內被处理。也就意味着，JS大约可以处理10ms时间，包括执行布局、绘制等，最多不超过16ms。尽管动画既可以通过JS也可以通过CSS处理，我们还是建议使用CSS而不是原生JS。</p>
<p><strong>使用 requestAnimationFrame()</strong></p>
<p><code>requestAnimationFrame</code> API允许开发者们匹配浏览器的帧率（通常是60fps）去运行动画。特别地，不同于<code>setInterval</code>或<code>setTimeout</code>，这个API在动画开始时被调用，所以，它可以一致且定期地被执行。此外，如果还没有显示页面的当前部分，也不会调用回调函数，因而可以省去执行不必要任务的时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Run Animation</span></span><br><span class="line">  requestAnimationFrame(animate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestAnimationFrame(animate);</span><br></pre></td></tr></table></figure>
<p><strong>使用CSS动画</strong><br>用JS处理动画很可能导致低性能。相反的是，CSS动画（不要求JS被执行），最适合在浏览器中执行，这是因为基于CSS的动画不会被主进程影响，从而使得动画可以更流畅。如果使用CSS3动画，同时遵守以下规则，可以在浏览器中呈现流畅的动画。</p>
<p><strong>position: absolute</strong><br>动画必须不影响附近的元素。如果<code>position</code>设置成<code>absolute</code>或<code>fixed</code>, 动画旁边的元素就不会被影响。</p>
<p><strong>transform</strong><br>当样式变更引起几何变化时（如高度、宽度、方位等），就会发生布局。受CSS的transform属性影响的元素分为几层，从而限制了元素受到布局和绘画的影响。此外，由于transform只能影响合成阶段，因此可以用于提高使用动画时的渲染速度。如果硬件支持使用GPU，则可以极大地提高性能。例如，在每个帧中都使用诸如left和top之类强制组合的属性，因此最好使用<code>transform: translate()</code>。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.animation-item</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute; <span class="comment">/* good */</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">animation</span>: move <span class="number">3s</span> ease infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* bad */</span></span><br><span class="line"><span class="keyword">@keyframes</span> move &#123;</span><br><span class="line">  50% &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* good */</span></span><br><span class="line"><span class="keyword">@keyframes</span> move &#123;</span><br><span class="line">  50% &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100px</span>, <span class="number">100px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><p>到此为止，本文档介绍了几种优化web应用性能的方案。优化web应用的最佳方案是弄明白浏览器加载和渲染进程，消除期间不必要的步骤。作者希望读者能够对着这篇指南，在各位的项目中应用到这些优化方案，为用户提供更好的服务性能。</p>
</script></p>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;margin-top:50px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/性能/" rel="tag"><i class="fa fa-tag"></i> 性能</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/04/21/node/node概览/" rel="next" title="nodejs">
                <i class="fa fa-chevron-left"></i> nodejs
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/08/16/js高级/05.纯函数-柯里化-组合函数/" rel="prev" title="05.纯函数-柯里化-组合函数">
                05.纯函数-柯里化-组合函数 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/杂记/one.jpg" alt="只有极其努力，才能看起来毫不费力。">
            
              <p class="site-author-name" itemprop="name">只有极其努力，才能看起来毫不费力。</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">50</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://15735046155.github.io/" title="GitHub &rarr; https://15735046155.github.io/" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#目录"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#性能优化必备的理论和衡量工具"><span class="nav-number">1.1.</span> <span class="nav-text">性能优化必备的理论和衡量工具</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#浏览器是如何加载的？"><span class="nav-number">1.1.1.</span> <span class="nav-text">浏览器是如何加载的？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#布局与重绘"><span class="nav-number">1.1.2.</span> <span class="nav-text">布局与重绘</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#阻塞资源和关键渲染路径"><span class="nav-number">1.1.3.</span> <span class="nav-text">阻塞资源和关键渲染路径</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#性能改善指标"><span class="nav-number">1.1.4.</span> <span class="nav-text">性能改善指标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#性能衡量工具"><span class="nav-number">1.1.5.</span> <span class="nav-text">性能衡量工具</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#网页加载优化"><span class="nav-number">1.2.</span> <span class="nav-text">网页加载优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#阻塞资源（CSS，JavaScript）优化"><span class="nav-number">1.2.1.</span> <span class="nav-text">阻塞资源（CSS，JavaScript）优化</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love" id="animate">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">只有极其努力，才能看起来毫不费力。</span>

  

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i>
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</div>

<span class="post-meta-divider">|</span>

<div class="powered-by">
<i class="fa fa-eye"></i>
  本站总访问量:<span id="busuanzi_value_site_pv"></span>
</div>

<!--

-->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  

  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.1"></script>




  
  <script src="/js/scrollspy.js?v=7.1.1"></script>
<script src="/js/post-details.js?v=7.1.1"></script>



  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').not('.gist .highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  


  
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>